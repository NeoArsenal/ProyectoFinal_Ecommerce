<div class="container">
  <h1>游닍 Gesti칩n de Productos</h1>

  <form [formGroup]="form" class="formulario">
    <input type="hidden" formControlName="id" />
    
    <div class="fila">
      <div class="campo">
         <label>Nombre:</label>
         <input type="text" formControlName="nombre" 
                [class.input-error]="esInvalido('nombre')"/>
         
         <!-- MENSAJES DE ERROR -->
         <small *ngIf="esInvalido('nombre')" class="msg-error">
            M칤nimo 3 letras
         </small>
      </div>

      <div class="campo">
         <label>Descripci칩n:</label>
         <input type="text" formControlName="descripcion" 
                [class.input-error]="esInvalido('descripcion')"/>
         <small *ngIf="esInvalido('descripcion')" class="msg-error">Requerido</small>
      </div>
    </div>

    <div class="fila">
      <div class="campo">
         <label>Precio:</label>
         <input type="number" formControlName="precio" 
                [class.input-error]="esInvalido('precio')"/>
         <small *ngIf="esInvalido('precio')" class="msg-error">Debe ser mayor a 0</small>
      </div>

      <div class="campo">
         <label>Stock:</label>
         <input type="number" formControlName="stock" 
                [class.input-error]="esInvalido('stock')"/>
         <small *ngIf="esInvalido('stock')" class="msg-error">No puede ser negativo</small>
      </div>
    </div>

    <div class="fila">
      <div class="campo">
          <label>Categor칤a:</label>
          <select formControlName="categoriaId" [class.input-error]="esInvalido('categoriaId')">
            <option [ngValue]="null">-- Seleccione --</option>
            <option *ngFor="let c of categorias" [value]="c.id">{{ c.nombre }}</option>
          </select>
          <small *ngIf="esInvalido('categoriaId')" class="msg-error">Seleccione una</small>
      </div>

      <div class="campo">
          <label>Proveedores (Ctrl + Clic):</label>
          <select formControlName="proveedorIds" multiple style="height: 80px;">
            <option *ngFor="let p of proveedores" [value]="p.id">{{ p.empresa }}</option>
          </select>
      </div>
    </div>

    <div class="botones">
      <!-- El bot칩n se deshabilita si el formulario es inv치lido -->
      <button type="button" (click)="alta()" [disabled]="form.invalid" class="btn-verde">Agregar</button>
      <button type="button" (click)="modificacion()" [disabled]="form.invalid || !form.value.id" class="btn-azul">Modificar</button>
      <button type="button" (click)="resetForm()" class="btn-gris">Limpiar</button>
    </div>
  </form>

  <table border="1">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Stock</th>
        <th>Categor칤a</th>
        <th>Proveedores</th>
        <th>Precio</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of productos">
          <td>{{ p.nombre }}</td>
          <td class="center">{{ p.stock }}</td>
          <td>{{ p.categoriaNombre }}</td>
          
          <!-- Columna Proveedores con etiquetas -->
          <td>
            <span *ngFor="let nombre of p.proveedorNombres" class="badge-prov">
              {{ nombre }}
            </span>
            <span *ngIf="!p.proveedorNombres?.length" style="color:#999; font-size:11px;">(Ninguno)</span>
          </td>
          
          <td class="num">S/ {{ p.precio | number:'1.2-2' }}</td>
          <td class="center">
              <button (click)="seleccionar(p)" class="btn-azul-sm">Editar</button>
              <button (click)="baja(p.id)" class="btn-rojo-sm">X</button>
          </td>
      </tr>
    </tbody>
  </table>
</div>

